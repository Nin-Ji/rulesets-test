name: Create Jira Task on Dependabot PR

on:
  pull_request:
    types: [opened]

jobs:
  create-jira-task:
    if: startsWith(github.head_ref, 'dependabot')
    runs-on: ubuntu-latest

    steps:
      - name: Create Jira Task
        env:
          JIRA_USER_EMAIL: ${{ secrets.JIRA_USER_EMAIL }}
          JIRA_API_TOKEN: ${{ secrets.JIRA_API_TOKEN }}
          JIRA_BASE_URL: ${{ secrets.JIRA_BASE_URL }}
          JIRA_PROJECT_KEY: "TR" 
        run: |
          curl -X POST "$JIRA_BASE_URL/rest/api/3/issue" \
            -u "$JIRA_USER_EMAIL:$JIRA_API_TOKEN" \
            -H "Content-Type: application/json" \
            -d '{
              "fields": {
                "project": { "key": "'"$JIRA_PROJECT_KEY"'" },
                "summary": "dependabot: '"${{ github.event.pull_request.title }}"'",
                "description": "A new dependabot PR has been created.\n\nPR Title: ${{ github.event.pull_request.title }}\nPR URL: ${{ github.event.pull_request.html_url }}",
                "issuetype": { "name": "Task" }
              }
            }'
